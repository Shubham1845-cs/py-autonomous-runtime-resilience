{% extends "base.html" %}
{% block title %}Dashboard | AutoHeal-Py{% endblock %}

{% block content %}
<div class="page-hero">
    <div class="page-hero-inner">
        <div class="page-hero-icon" style="--ic:#3b82f6">
            <i class="fa-solid fa-gauge-high"></i>
        </div>
        <div>
            <h1>Real-Time Dashboard</h1>
            <p>Live service health, failure rates and pattern status</p>
        </div>
        <div class="live-badge">
            <span class="live-dot"></span>
            <span>Updating Live</span>
        </div>
    </div>
</div>

<div class="container">
    <!-- Global Stats Bar -->
    <div class="stat-bar">
        <div class="sbar-item">
            <i class="fa-solid fa-server" style="color:#3b82f6"></i>
            <div>
                <strong id="dash-services">0</strong>
                <span>Services</span>
            </div>
        </div>
        <div class="sbar-sep"></div>
        <div class="sbar-item">
            <i class="fa-solid fa-arrow-right-arrow-left" style="color:#a855f7"></i>
            <div>
                <strong id="dash-calls">0</strong>
                <span>Total Calls</span>
            </div>
        </div>
        <div class="sbar-sep"></div>
        <div class="sbar-item">
            <i class="fa-solid fa-shield-halved" style="color:#10b981"></i>
            <div>
                <strong id="dash-patterns">0</strong>
                <span>Active Patterns</span>
            </div>
        </div>
        <div class="sbar-sep"></div>
        <div class="sbar-item">
            <i class="fa-solid fa-circle-check" style="color:#f59e0b" id="dash-status-icon"></i>
            <div>
                <strong id="dash-status">Loading…</strong>
                <span>System Status</span>
            </div>
        </div>
    </div>

    <!-- Agent Status Mini-Bar -->
    <div class="section-header" style="margin-top:2rem">
        <h2><i class="fa-solid fa-brain"></i> AutoHeal Agent</h2>
        <div class="agent-status-bar" id="agent-status-bar">
            <span class="agent-pill"><i class="fa-solid fa-rotate fa-spin"></i> <span id="ag-scans">—</span>
                scans</span>
            <span class="agent-pill"><i class="fa-solid fa-clock"></i> <span id="ag-uptime">—</span></span>
            <span class="agent-pill"><i class="fa-solid fa-shield-halved" style="color:var(--green)"></i> <span
                    id="ag-active">—</span> active</span>
            <span class="agent-pill" id="ag-running-pill"><i class="fa-solid fa-circle" style="color:var(--green)"></i>
                Running</span>
        </div>
    </div>

    <!-- Services -->
    <div class="section-header" style="margin-top:1.5rem">
        <h2><i class="fa-solid fa-network-wired"></i> Service Health</h2>
    </div>

    <div class="services-grid" id="services-container">
        <div class="empty-card">
            <i class="fa-solid fa-satellite-dish fa-spin"></i>
            <p>Scanning for monitored services…</p>
        </div>
    </div>

    <!-- Agent Events Feed -->
    <div class="section-header" style="margin-top:2.5rem">
        <h2><i class="fa-solid fa-timeline"></i> Agent Events <span class="live-badge" style="font-size:.7rem"><span
                    class="live-dot"></span>Live</span></h2>
    </div>

    <div class="events-feed" id="events-feed">
        <div class="event-empty">
            <i class="fa-solid fa-hourglass-half fa-beat-fade"></i>
            <span>Waiting for agent events…</span>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}